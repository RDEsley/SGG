<div class="container">
  <div class="page-header">
    <h1>Gerenciamento de Incubação</h1>
    <button mat-raised-button color="primary" (click)="novaAlocacao()">
      <mat-icon>add</mat-icon>
      Nova Alocação
    </button>
  </div>

  <div *ngIf="loading" class="loading-spinner">
    <mat-spinner></mat-spinner>
  </div>

  <div *ngIf="!loading && chocadeiras.length === 0" class="empty-state">
    <mat-icon>thermostat</mat-icon>
    <p>Nenhuma chocadeira cadastrada no sistema</p>
  </div>

  <div *ngIf="!loading && chocadeiras.length > 0">
    <div class="chocadeiras-grid">
      <mat-card *ngFor="let chocadeira of chocadeiras" class="chocadeira-card">
        <mat-card-header>
          <mat-card-title>{{ chocadeira.nome }}</mat-card-title>
          <mat-card-subtitle>
            Capacidade: {{ chocadeira.capacidade }} ovos
          </mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <div class="ocupacao-info">
            <div class="ocupacao-stats">
              <span>{{ calcularOcupacao(chocadeira) }} / {{ chocadeira.capacidade }}</span>
              <span style="font-size: 12px; color: #666">
                ({{ calcularPercentualOcupacao(chocadeira) | number:'1.0-0' }}%)
              </span>
            </div>
            <div class="ocupacao-bar">
              <div class="ocupacao-progress"
                   [style.width.%]="calcularPercentualOcupacao(chocadeira)"
                   [style.background-color]="getStatusColor(chocadeira)">
              </div>
            </div>
          </div>

          <div class="alocacoes-list" *ngIf="getAlocacoesPorChocadeira(chocadeira.id).length > 0">
            <h4>Alocações Ativas</h4>
            <div *ngFor="let alocacao of getAlocacoesPorChocadeira(chocadeira.id)" class="alocacao-item">
              <div class="alocacao-info">
                <strong>{{ alocacao.lotes_ovos?.racas?.nome || 'Raça não definida' }}</strong>
                <span>{{ alocacao.quantidade }} ovos</span>
                <span class="dias-restantes">
                  {{ getDiasRestantes(alocacao.data_previsao_nascimento) }} dias restantes
                </span>
              </div>
              <div class="alocacao-actions">
                <button mat-icon-button (click)="transferir(alocacao)" matTooltip="Transferir">
                  <mat-icon>swap_horiz</mat-icon>
                </button>
                <button mat-icon-button (click)="finalizarIncubacao(alocacao)" matTooltip="Finalizar">
                  <mat-icon>check_circle</mat-icon>
                </button>
              </div>
            </div>
          </div>

          <div *ngIf="getAlocacoesPorChocadeira(chocadeira.id).length === 0" class="no-alocacoes">
            <mat-icon>info</mat-icon>
            <span>Sem alocações ativas</span>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>
